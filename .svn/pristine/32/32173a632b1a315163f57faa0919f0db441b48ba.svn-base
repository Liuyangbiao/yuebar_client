package com.fullteem.yueba.app.ui;

import android.content.Intent;
import android.graphics.drawable.Drawable;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.CompoundButton.OnCheckedChangeListener;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;

import com.fullteem.yueba.R;
import com.fullteem.yueba.download.UpdateManager;
import com.fullteem.yueba.util.SharePreferenceUtil;
import com.fullteem.yueba.widget.TopTitleView;

/**
 * @author jun
 * @version 1.0.0
 * @created 2014年12月10日&emsp;下午5:05:16
 * @use 类说明
 */
public class SetActivity extends BaseActivity {
	private Button btnSetVoice, btnUpdate, btnLevelCharmExplain;
	private CheckBox ckbSetVoice, ckbSetVibrate;
	private RelativeLayout rlSetViocePrompt;
	private TextView tvSetViocePrompt;
	private LinearLayout llSetVoiceControl;
	private Drawable[] drawableArrow; // drawableArrow[0]
										// down_arrow,drawableArrow[1] up_arrow,
	private EventListener mListener;

	public SetActivity() {
		super(R.layout.activity_set);
	}

	@Override
	public void initViews() {
		initTopTitle();
		btnSetVoice = (Button) findViewById(R.id.btn_setVoice);
		btnUpdate = (Button) findViewById(R.id.btn_update);
		btnLevelCharmExplain = (Button) findViewById(R.id.btn_levelCharmExplain);
		ckbSetVoice = (CheckBox) findViewById(R.id.ckb_setVoice);
		ckbSetVibrate = (CheckBox) findViewById(R.id.ckb_setVibrate);
		rlSetViocePrompt = (RelativeLayout) findViewById(R.id.rl_setViocePrompt);
		tvSetViocePrompt = (TextView) findViewById(R.id.tv_setViocePrompt);
		llSetVoiceControl = (LinearLayout) findViewById(R.id.ll_setvoiceControl);

		ckbSetVoice.setChecked(SharePreferenceUtil.getInstance(this).getSettingMsgSound());
		ckbSetVibrate.setChecked(SharePreferenceUtil.getInstance(this).getSettingMsgVibrate());
	}

	@Override
	public void initData() {
		drawableArrow = new Drawable[2];
		drawableArrow[0] = getResources().getDrawable(R.drawable.down_arrow_icon);
		drawableArrow[1] = getResources().getDrawable(R.drawable.up_arrow_icon);
		drawableArrow[0].setBounds(0, 0, drawableArrow[0].getMinimumWidth(), drawableArrow[0].getMinimumHeight());
		drawableArrow[1].setBounds(0, 0, drawableArrow[1].getMinimumWidth(), drawableArrow[1].getMinimumHeight());

		mListener = new EventListener();
	}

	@Override
	public void bindViews() {
		btnSetVoice.setOnClickListener(mListener);
		btnUpdate.setOnClickListener(mListener);
		btnLevelCharmExplain.setOnClickListener(mListener);
		ckbSetVoice.setOnCheckedChangeListener(mListener);
		ckbSetVibrate.setOnCheckedChangeListener(mListener);
	}

	private void initTopTitle() {
		TopTitleView topTitle = (TopTitleView) findViewById(R.id.top_title);
		topTitle.showLeftImag(R.drawable.back, new OnClickListener() {
			@Override
			public void onClick(View v) {
				finish();
			}
		});
		topTitle.showCenterText(getString(R.string.perssonal_set), null);
	}

	private class EventListener implements OnClickListener, OnCheckedChangeListener {
		@Override
		public void onClick(View v) {
			switch (v.getId()) {
			case R.id.btn_setVoice:
				if (llSetVoiceControl.getVisibility() == View.VISIBLE) {
					btnSetVoice.setCompoundDrawables(btnSetVoice.getCompoundDrawables()[0], null, drawableArrow[0], null);
					llSetVoiceControl.setVisibility(View.GONE);
				} else if (llSetVoiceControl.getVisibility() == View.GONE) {
					btnSetVoice.setCompoundDrawables(btnSetVoice.getCompoundDrawables()[0], null, drawableArrow[1], null);
					llSetVoiceControl.setVisibility(View.VISIBLE);
				}
				break;
			case R.id.btn_levelCharmExplain:
				startActivity(new Intent(SetActivity.this, LevelAndCharmExplainActivity.class));
				break;
				
			case R.id.btn_update:
				UpdateManager manager = new UpdateManager(SetActivity.this);
				manager.checkUpdate();
				break ;
			}
		}

		@Override
		public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
			switch (buttonView.getId()) {
			case R.id.ckb_setVoice:
				//				SharePreferenceUtil.getInstance(SetActivity.this).saveBooleanToShare(GlobleConstant.NOTICE_SOUND, ckbSetVoice.isChecked());
				SharePreferenceUtil.getInstance(SetActivity.this).setSettingMsgSound(ckbSetVoice.isChecked());
				break;
			case R.id.ckb_setVibrate:
				//				SharePreferenceUtil.getInstance(SetActivity.this).saveBooleanToShare(GlobleConstant.NOTICED_VIBRATE, ckbSetVibrate.isChecked());
				SharePreferenceUtil.getInstance(SetActivity.this).setSettingMsgVibrate(ckbSetVibrate.isChecked());
				break;
			}
		}
	}

}
